
# 会員証アプリおよびチェックインシステム 要件定義

本ドキュメントは、**会員証アプリ**と**チェックインシステム**の機能要件・非機能要件・連携要件について整理したものです。  
チェックイン方法として、以下の2方式に対応します。

- パターンA：**認証端末がQRコードを発行し、会員アプリがスキャンしてチェックイン**
- パターンB：**会員アプリがQRコードを発行し、認証端末がスキャンしてチェックイン**

---

## 📌 ユースケース図（Mermaid Diagram）

```mermaid
%%{ init : { "theme" : "default" } }%%
graph TD
  subgraph 会員ユーザー
    UA1[表示用QRコードを生成] --> T2[認証端末がQRコードを読み取りチェックイン]:::b
    T1[認証端末がQRコードを表示] --> UA2[アプリがQRコードをスキャンしてチェックイン]:::a
  end

  subgraph 店舗施設端末
    T1 -.-> T3[予約情報と照合]
    T2 -.-> T3
    T3 --> T4[チェックイン履歴を管理]
  end

  subgraph 管理者
    M1[ユーザー管理] --> UA1
    M2[予約情報管理] --> T3
    M3[店舗・端末設定] --> T1
    M4[統計レポート確認] --> T4
  end

  classDef a fill:#fdf6e3,stroke:#000;
  classDef b fill:#e8f5e9,stroke:#000;
```

---

## ✅ 機能要件

### 会員アプリ（ユーザー側）

- 会員証表示（会員ID、氏名、有効期限など）
- チェックイン履歴の表示
- 予約情報の確認（連携時）
- パターンA対応：
  - 認証端末が表示するQRを読み取り、チェックインリクエストを送信
- パターンB対応：
  - 自身の会員情報を含むQRコードを生成し提示

---

### 認証端末（店舗・施設側）

- パターンA対応：
  - 一時トークンQRコードの生成と表示
  - 会員アプリからのチェックインリクエストを受信
- パターンB対応：
  - アプリのQRコードをスキャンし、サーバにチェックインリクエストを送信
- 共通：
  - 予約情報との照合（該当する場合）
  - チェックイン履歴の閲覧・検索

---

### 管理者機能

- ユーザー（会員）管理（登録・編集・無効化）
- 店舗・端末設定（名称、設置場所、営業時間など）
- 予約管理と連携確認
- チェックイン履歴の集計・出力
- チェックイン方式（A/B）ごとのログ管理

---

## 🔐 QRコード仕様例

| 用途 | 内容 | 有効期間 | 備考 |
|------|------|----------|------|
| 認証端末発行型 | 一時トークン（署名付き） | 数十秒～数分 | ワンタイム使用 |
| アプリ発行型 | 会員ID＋署名＋タイムスタンプ | 数分 | 店舗端末側で検証 |

---

## 🔄 外部連携要件

- 予約システムとのAPI連携
  - 予約内容の取得／同期／状態更新
  - チェックイン時の照合に使用
- ID認証サービスとの連携（LINE, Google, Apple など）

---

## 🛡️ 非機能要件

- セキュリティ
  - QRトークンは改ざん不可の署名付き（例：JWT, HMAC）
  - 有効期限管理、ワンタイムトークン化
- 可用性
  - 多拠点同時利用時の負荷耐性
- スケーラビリティ
  - NFC・BLE・顔認証などの将来的な拡張を考慮
- 対応環境
  - iOS / Android / タブレット / 店舗側PC・専用端末
- 多言語対応
  - UIの英語・日本語対応（観光施設などを想定）

---

## 🧪 チェックインフロー図（参考）

### パターンA（認証端末がQR提示）

```mermaid
sequenceDiagram
  participant Terminal as 認証端末
  participant App as 会員アプリ
  participant Server as サーバ

  Terminal->>App: 一時QRコードを表示
  App->>Server: チェックインリクエスト（トークン付き）
  Server-->>Terminal: チェックイン成功通知
  Server-->>App: チェックイン完了表示
```

---

### パターンB（アプリがQR提示）

```mermaid
sequenceDiagram
  participant App as 会員アプリ
  participant Terminal as 認証端末
  participant Server as サーバ

  App->>Terminal: QRコード表示（会員ID＋署名）
  Terminal->>Server: チェックインリクエスト
  Server-->>Terminal: 成功通知
  Server-->>App: 状態同期（任意）
```

---

## 📎 補足：オプション制限

- 営業時間外チェックイン制限
- 予約必須チェックイン制限
- 同一会員の同時複数拠点チェックイン制限
- サービス種別ごとのチェックイン制御

---

## 📂 今後の拡張項目

- 顔認証／生体認証との連携
- スマートロック・ゲートとの統合
- POSとの統合（来店ポイント処理など）

---
